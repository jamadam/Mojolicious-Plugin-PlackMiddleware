=head1 NAME

MojoX::Util::PlackMiddleware - Response Filter in Plack::Middleware style

=head1 SYNOPSIS

    sub startup {
        ....
        
        my $self = shift;
        
        # Mojolicious
        $self->plugin(plack_middleware => [
            'Some1', 
            'Some2', {arg1 => 'some_vale'}
        ]);
        $self->plugin(plack_middleware => [
            'Some1', sub {$condition}, 
            'Some2', sub {$condition}, {arg1 => 'some_vale'}
        ]);
        
        # Mojolicious::Lite
        plugin plack_middleware => [
            'Some1', 
            'Some2', {arg1 => 'some_vale'}
        ];
        plugin plack_middleware => [
            'Some1', sub {$condition}, 
            'Some2', sub {$condition}, {arg1 => 'some_vale'}
        ]);
    }
    
    package Plack::Middleware::Some;
    use strict;
    use warnings;
    use base qw( Plack::Middleware );
    
    sub call {
        
        my ($self, $env) = @_;
        $self->response_cb($self->app->($env), sub {
            my $res = shift;
            
            ### DO SOMETHING
            
            $res;
        });
    }

=head1 DESCRIPTION

Mojolicious::Plugin::PlackMiddleware allows you to enable Plack::Middleware
inside Mojolicious as after_dispatch hook.

=head2 OPTIONS

This plugin takes an argument in Array reference which contains some
middlewares. Each middleware can be followed by callback function for
conditional activation, and attributes for middleware.

    my $condition = sub {
        my $c = shift; # Mojolicious controller
        if (...) {
            return 1; # causes the middleware hooked
        }
    };
    plugin plack_middleware => [
        Plack::Middleware::Some2, $condition, {arg1 => 'some_vale'},
    ];

=head1 METHODS

=head2 register

$plugin->register;

Register plugin hooks in L<Mojolicious> application.

=head1 AUTHOR

Sugama Keita, E<lt>sugama@jamadam.comE<gt>

=head1 COPYRIGHT AND LICENSE

Copyright (C) 2011 by Sugama Keita.

This program is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.

=cut
